#!/usr/bin/env ruby
require_relative '../lib/game_logic'
require_relative '../lib/players'

puts 'Welcome to Tic-Tac-Toe'
sleep(1)
puts 'Before we start may we know your names'
sleep(1)

game_on = true

until game_on == false
  puts 'Player 1 please enter your name'
  player1 = Player.new(gets.chomp)
  until player1.valid_name?
    puts 'Please enter a valid name'
    player1.name = gets.chomp
  end
  puts 'Player 2 please enter your name'
  player2 = Player.new(gets.chomp)
  until player2.valid_name?
    puts 'Please enter a valid name'
    player2.name = gets.chomp
  end
  puts
  game_board = [1, 2, 3, 4, 5, 6, 7, 8, 9]
  puts GameLogic.display_board(game_board)
  active_player = player1
  mark = player1.player1_mark

  count = 0

  while count < 9
    puts
    puts "#{active_player.name} select the number (1-9) for your move"
    puts
    current_move = gets.chomp.to_i

    if GameLogic.valid_input?(current_move, game_board) == false
      puts
      puts 'Please enter a valid move, a number between 1 to 9 and that is not taken already'
      puts
      puts GameLogic.display_board(game_board)
      next
    end

    game_board[current_move - 1] = mark
    count += 1
    puts GameLogic.display_board(game_board)
    puts

    if active_player == player1
      active_player = player2
      mark = active_player.player2_mark
    else
      active_player = player1
      mark = active_player.player1_mark
    end

    case GameLogic.winning_cases(game_board)
    when 'X'
      puts "#{player2.name} won, congrats"
      puts
      puts GameLogic.display_board(game_board)
      break
    when 'O'
      puts "#{player1.name} won, congrats"
      puts
      puts GameLogic.display_board(game_board)
      break
    end

    if count == 9
      puts "It's a draw game"
      break
    end

  end

  puts
  puts 'Play again? press "Y" or press any other key to quit'
  input = gets.chomp.upcase
  game_on = true if input == 'Y'
  break if input != 'Y'
end
